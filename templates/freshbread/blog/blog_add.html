{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add Blog - Kingfood</title>
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
  
  <script src="https://cdn.tiny.cloud/1/rbq7zvmu93mleux2vh63i3huoolyjb4c145533xy3fjjmt19/tinymce/8/tinymce.min.js" referrerpolicy="origin" crossorigin="anonymous"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      tinymce.init({
        selector:'#content',
        height: 360,
        menubar: true,
        plugins: 'lists link image table code advlist autolink charmap print preview anchor textcolor',
        toolbar: 'undo redo | formatselect | fontselect fontsizeselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | code',
        content_style: 'body { font-family:Athiti, sans-serif; font-size:16px }'
      });
      const form = document.getElementById('blog-form');
      form.addEventListener('submit', async function(e){
        const title = document.getElementById('title').value.trim();
        const content = tinymce.get('content').getContent({ format:'html' }).trim();
        const listFile = document.getElementById('cover_list').files[0];
        const singleFile = document.getElementById('cover_single').files[0];
        if(!title || !content || !listFile || !singleFile){
          e.preventDefault(); alert('Title, content, and both images are required.'); return;
        }
        async function checkDims(file, maxW, maxH){
          return new Promise((resolve)=>{
            const fr = new FileReader();
            fr.onload = function(){
              const img = new Image();
              img.onload = function(){ resolve({w: img.naturalWidth, h: img.naturalHeight}); };
              img.src = fr.result;
            };
            fr.readAsDataURL(file);
          });
        }
        const d1 = await checkDims(listFile, 570, 470);
        if(d1.w>570 || d1.h>470){ e.preventDefault(); alert('List image must not exceed 570x470.'); return; }
      });
    });
  </script>
</head>
<body>
{% include 'freshbread/header.html' %}
<div class="container mt-4">
<h2></h2><br>
<h2></h2><br>
  <h2>Add Blog</h2>
  {% if messages %}
    {% for m in messages %}<div class="alert alert-{{ m.tags }}">{{ m }}</div>{% endfor %}
  {% endif %}
  <form id="blog-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
      <label>Title</label>
      <input id="title" name="title" class="form-control" required>
    </div>
    <div class="form-group">
      <label>Content</label>
      <textarea id="content" name="content"></textarea>
    </div>
    <div class="form-group">
      <label>SEO Keywords</label>
      <input name="seo_keywords" class="form-control" placeholder="e.g., bakery, bread, cakes">
    </div>
    <div class="form-group">
      <label>Tags (use #tag format, space-separated)</label>
      <input name="tags" class="form-control" placeholder="#bread #cake">
    </div>
    <div class="form-group">
      <label>Blog list image (max 570x470, portrait)</label>
      <input id="cover_list" name="cover_list" type="file" accept="image/*" class="form-control" required>
      <small class="text-muted">If smaller, it will be blurred on the list to maintain layout.</small>
    </div>
    <div class="form-group">
      <label>Blog single image</label>
      <input id="cover_single" name="cover_single" type="file" accept="image/*" class="form-control" required>
    </div>
    <button class="btn btn-primary">Submit</button>
  </form>
  <div class="mt-3">
    <a class="btn btn-link" href="{% url 'blog_manage' %}">Manage my blogs</a>
  </div>
</div>
{% include 'freshbread/footer.html' %}
	<script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- ALL PLUGINS -->
	<script src="{% static 'js/jquery.superslides.min.js' %}"></script>
	<script src="{% static 'js/images-loded.min.js' %}"></script>
	<script src="{% static 'js/isotope.min.js' %}"></script>
	<script src="{% static 'js/baguetteBox.min.js' %}"></script>
	<script src="{% static 'js/form-validator.min.js' %}"></script>
    <script src="{% static 'js/contact-form-script.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
</body>
</html>