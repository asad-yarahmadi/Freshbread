{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>User Profile - Fresh Bread</title>
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/style.css' %}">
	<link rel="stylesheet" href="{% static 'css/responsive.css' %}">
	<link rel="stylesheet" href="{% static 'css/custom.css' %}">
    

	<style>
		.profile-section {
			padding: 100px 0 80px;
			background-color: #fafafa;
		}
		.profile-card {
			background: #fff;
			border-radius: 20px;
			padding: 40px 30px;
			box-shadow: 0 10px 25px rgba(0,0,0,0.1);
			max-width: 750px;
			margin: auto;
		}
		.profile-img {
			text-align: center;
			margin-bottom: 25px;
		}
		.profile-img img {
			width: 130px;
			height: 130px;
			object-fit: cover;
			border-radius: 50%;
			border: 4px solid #28a745;
			box-shadow: 0 4px 10px rgba(0,0,0,0.2);
		}
		.profile-form label {
			font-weight: 600;
			margin-top: 10px;
			color: #444;
		}
		.profile-form input, .profile-form textarea {
			border-radius: 10px;
			padding: 10px 15px;
			border: 1px solid #ddd;
			width: 100%;
			font-size: 15px;
		}
		#map {
			height: 350px;
			border-radius: 15px;
			margin-top: 15px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			position: relative;
		}
		.map-pin {
			position: absolute;
			top: 50%;
			left: 50%;
			width: 30px;
			height: 30px;
			transform: translate(-50%, -100%);
			z-index: 999;
			pointer-events: none;
		}
		.map-pin img {
			width: 30px;
			height: 30px;
		}
		#location-status {
			margin-top: 10px;
			font-size: 14px;
			color: #666;
		}
		.location-btn {
			margin-top: 10px;
			background-color: #007bff;
			color: white;
			border: none;
			padding: 8px 15px;
			border-radius: 8px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		.location-btn:hover {
			background-color: #0056b3;
		}
		.save-btn {
			margin-top: 20px;
			width: 100%;
			padding: 12px 0;
			border-radius: 30px;
			font-weight: 600;
			font-size: 16px;
		}
	</style>
  </head>
<body>
{% include 'freshbread/header.html' %}




<section class="profile-section">
	<div class="container">
		<div class="profile-card">
            <div class="profile-img">
                <img id="avatarPreview" src="{{ profile.avatar.url }}" alt="User Profile" style="border-radius:50%; width:130px; height:130px; object-fit:cover; border:4px solid #28a745; box-shadow:0 4px 10px rgba(0,0,0,0.2)" onerror="this.onerror=null;this.src='{% static 'images/def.jpg' %}'">
                <div class="mt-2">
                    <button type="button" class="btn btn-warning btn-sm" id="changePhotoBtn">Change Photo</button>
                </div>
                <div id="cropper" style="display:none; margin-top:15px;">
                  <div style="position:relative; width:300px; height:300px; margin:0 auto;">
                    <canvas id="cropCanvas" width="300" height="300" style="border-radius:12px; background:#f8f9fa"></canvas>
                    <div style="position:absolute; inset:0; pointer-events:none; background:radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 45%, rgba(0,0,0,0.35) 46%);"></div>
                  </div>
                  <div class="d-flex align-items-center justify-content-center mt-2">
                    <input type="range" id="zoomRange" min="0.5" max="3" value="1" step="0.01" style="width:200px;">
                    <button type="button" class="btn btn-outline-secondary btn-sm ml-2" id="resetCrop">Reset</button>
                  </div>
                </div>
            </div>

            <form class="profile-form" method="post" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="avatar" id="profileImage" accept="image/*" style="display:none">
                <input type="hidden" name="avatar_cropped" id="avatarCropped">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="first_name" placeholder="John" value="{{ values.first_name|default:user.first_name }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="last_name" placeholder="Doe" value="{{ values.last_name|default:user.last_name }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" placeholder="john@example.com" value="{{ values.email|default:user.email }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" name="phone" placeholder="+1 234 567 890" value="{{ values.phone|default:profile.phone|default_if_none:'' }}" required>
                    </div>
                </div>

                <!-- Location editing removed; use Locations page -->

                <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea id="bio" name="bio" rows="3" placeholder="Tell us something about yourself..." required>{{ values.bio }}</textarea>
                </div>

                <button type="submit" class="btn btn-success save-btn">ðŸ’¾ Save Changes</button>
            </form>
		</div>
	</div>
</section>

	<!-- Start Customer Reviews -->
	<div class="customer-reviews-box">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="heading-title text-center">
						<h2>Customer Reviews</h2>
						<p>You can know Reviews from our Customers(you can add too!)</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-8 mr-auto ml-auto text-center">
					<div id="reviews" class="carousel slide" data-ride="carousel">
						<div class="carousel-inner mt-4">
							<div class="carousel-item text-center active">
								<div class="img-box p-1 border rounded-circle m-auto">
									<img class="d-block w-100 rounded-circle" src="{% static 'images/profile-1.jpg' %}" alt="">
								</div>
								<h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Paul Mitchel</strong></h5>
								<h6 class="text-dark m-0">Web Developer</h6>
								<p class="m-0 pt-3">It has a lot of delicious food. It also has a very strong website designer. Overall, thank you.</p>
							</div>
							<div class="carousel-item text-center">
								<div class="img-box p-1 border rounded-circle m-auto">
									<img class="d-block w-100 rounded-circle" src="{% static 'images/profile-3.jpg' %}" alt="">
								</div>
								<h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Steve Fonsi</strong></h5>
								<h6 class="text-dark m-0">Web Designer</h6>
								<p class="m-0 pt-3">It has good food and user interface. Thanks.</p>
							</div>
							<div class="carousel-item text-center">
								<div class="img-box p-1 border rounded-circle m-auto">
									<img class="d-block w-100 rounded-circle" src="{% static 'images/def.jpg' %}" alt="">
								</div>
								<h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Daniel vebar</strong></h5>
								<h6 class="text-dark m-0">Seo Analyst</h6>
								<p class="m-0 pt-3">Good and tasty food and fast foods. I think in Otawwa and Knanta its the best Fast food and bakery here.</p>
							</div>
						</div>
						<a class="carousel-control-prev" href="#reviews" role="button" data-slide="prev">
							<i class="fa fa-angle-left" aria-hidden="true"></i>
							<span class="sr-only">Previous</span>
						</a>
						<a class="carousel-control-next" href="#reviews" role="button" data-slide="next">
							<i class="fa fa-angle-right" aria-hidden="true"></i>
							<span class="sr-only">Next</span>
						</a>
                    </div>
				</div>
			</div>
		</div>
	</div>
	<!-- End Customer Reviews -->
	
	<!-- Start Contact info -->

	<!-- End Contact info -->
	
    {% include 'freshbread/footer.html' %}

<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
	<script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- ALL PLUGINS -->
	<script src="{% static 'js/jquery.superslides.min.js' %}"></script>
	<script src="{% static 'js/images-loded.min.js' %}"></script>
	<script src="{% static 'js/isotope.min.js' %}"></script>
	<script src="{% static 'js/baguetteBox.min.js' %}"></script>
	<script src="{% static 'js/form-validator.min.js' %}"></script>
    <script src="{% static 'js/contact-form-script.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
<script>
document.getElementById('changePhotoBtn').addEventListener('click', function(){
  document.getElementById('profileImage').click();
});
document.getElementById('profileImage').addEventListener('change', function(e){
  const file = e.target.files[0];
  if (!file) return;
  if (!file.type.startsWith('image/')) { alert('Please select an image.'); return; }
  const reader = new FileReader();
  reader.onload = function(ev){
    const img = new Image();
    img.onload = function(){
      const canvas = document.getElementById('cropCanvas');
      const ctx = canvas.getContext('2d');
      let scale = 1;
      let dx = 0;
      let dy = 0;
      const zoom = document.getElementById('zoomRange');
      const cropper = document.getElementById('cropper');
      cropper.style.display = 'block';
      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const w = img.width * scale;
        const h = img.height * scale;
        const x = canvas.width/2 + dx - w/2;
        const y = canvas.height/2 + dy - h/2;
        ctx.drawImage(img, x, y, w, h);
      }
      let dragging = false;
      let sx = 0; let sy = 0;
      canvas.onmousedown = function(ev){ dragging = true; sx = ev.clientX; sy = ev.clientY; };
      window.onmouseup = function(){ dragging = false; };
      window.onmousemove = function(ev){ if(!dragging) return; dx += ev.clientX - sx; dy += ev.clientY - sy; sx = ev.clientX; sy = ev.clientY; draw(); };
      zoom.oninput = function(){ scale = parseFloat(zoom.value); draw(); };
      document.getElementById('resetCrop').onclick = function(){ scale = 1; dx = 0; dy = 0; zoom.value = '1'; draw(); };
      draw();
      const form = document.querySelector('.profile-form');
      form.addEventListener('submit', function(){
        const out = document.createElement('canvas');
        out.width = 512; out.height = 512;
        const octx = out.getContext('2d');
        const factor = out.width / canvas.width;
        const w = img.width * scale * factor;
        const h = img.height * scale * factor;
        const x = out.width/2 + dx*factor - w/2;
        const y = out.height/2 + dy*factor - h/2;
        octx.fillStyle = '#fff';
        octx.fillRect(0,0,out.width,out.height);
        octx.drawImage(img, x, y, w, h);
        const dataUrl = out.toDataURL('image/png');
        document.getElementById('avatarCropped').value = dataUrl;
        document.getElementById('avatarPreview').src = dataUrl;
      }, { once: true });
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});
</script>
</body>
</html>
