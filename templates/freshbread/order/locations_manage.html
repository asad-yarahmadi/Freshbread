{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Locations - Kingfood</title>
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">

</head>
<body>
{% include 'freshbread/header.html' %}
  <h2></h2><br>  
  <h2></h2><br>
  <h2></h2><br>
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        
      <h2>Your Locations</h2>
      <a class="btn btn-primary" href="{% url 'location_add' %}">+ Add Location</a>
    </div>
    {% for loc in locations %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">
            {{ loc.receiver_is_user|yesno:"You are the receiver,Someone else" }}
          </h5>
          <p class="mb-1"><strong>Receiver:</strong> {{ loc.receiver_name|default:"—" }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ loc.receiver_phone|default:"—" }}</p>
          <p class="mb-1"><strong>Postal Code:</strong> {{ loc.postal_code }}</p>
          <p class="mb-3"><strong>Address:</strong> {{ loc.address_line }}</p>
          <div id="map-{{ forloop.counter }}" style="height:250px;border-radius:12px;"></div>
          <div class="mt-3">
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'location_edit' loc.id %}">Edit</a>
            <a class="btn btn-sm btn-outline-danger" href="{% url 'location_delete' loc.id %}">Delete</a>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No locations yet. Click "Add Location" to create one.</p>
    {% endfor %}
  </div>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
	<script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- ALL PLUGINS -->
	<script src="{% static 'js/jquery.superslides.min.js' %}"></script>
	<script src="{% static 'js/images-loded.min.js' %}"></script>
	<script src="{% static 'js/isotope.min.js' %}"></script>
	<script src="{% static 'js/baguetteBox.min.js' %}"></script>
	<script src="{% static 'js/form-validator.min.js' %}"></script>
    <script src="{% static 'js/contact-form-script.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tiles = (map) => L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution: '&copy; OpenStreetMap contributors'}).addTo(map);
      const kanataBounds = L.latLngBounds([45.25, -76.05], [45.40, -75.75]);
      {% for loc in locations %}
      (function(){
        const el = document.getElementById('map-{{ forloop.counter }}');
        const map = L.map(el, { center: [{{ loc.latitude }}, {{ loc.longitude }}], zoom: 15, maxBounds: kanataBounds, maxBoundsViscosity: 1.0 });
        tiles(map);
        L.marker([{{ loc.latitude }}, {{ loc.longitude }}]).addTo(map);
      })();
      {% endfor %}
    });
  </script>
  {% include 'freshbread/footer.html' %}
</body>
</html>