{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Email Sender - Kingfood</title>
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
  <link rel="stylesheet" href="{% static 'css/custom.css' %}">
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">

</head>
<body>
{% include 'freshbread/header.html' %}
<h2></h2><br>
<h2></h2><br>
<h2></h2><br>

<h1 class="text-center">Admin Email Sender</h1>
<section class="py-5" style="background:#fafafa;">
  <div class="container">
    <div class="card p-4" style="border-radius:16px;">
      <h3 class="mb-3">Send Email</h3>
      <form method="post" action="">
        {% csrf_token %}
        <div class="form-group">
          <label>Subject</label>
          <input type="text" name="subject" class="form-control" required>
        </div>
        <div class="form-group mt-3">
          <label>Body</label>
          <div class="mb-2">
            <select id="placeholders" class="form-control" style="max-width:260px; display:inline-block;">
              <option value="">Insert placeholder…</option>
              <option value="{username}">Username</option>
              <option value="{first_name}">First Name</option>
              <option value="{last_name}">Last Name</option>
            </select>
            <button type="button" id="insertPlaceholder" class="btn btn-outline-secondary btn-sm">Insert</button>
          </div>
          <textarea name="body" id="body" rows="6" class="form-control" placeholder="Dear {username}, our blackfriday is started." required></textarea>
        </div>
        <div class="form-row mt-3">
          <div class="form-group col-md-4">
            <label>Audience</label>
            <select name="audience" class="form-control">
              <option value="all">All users</option>
              <option value="admins">Only admins</option>
              <option value="users">Only users</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label>Repeat</label>
            <select name="repeat" id="repeat" class="form-control">
              <option value="none">Send once</option>
              <option value="daily">Every day</option>
              <option value="weekly">Every week</option>
              <option value="monthly">Every month</option>
              <option value="custom">Custom…</option>
            </select>
          </div>
          <div class="form-group col-md-4" id="customDaysBox" style="display:none;">
            <label>Custom interval (days)</label>
            <input type="number" name="interval_days" min="1" class="form-control" placeholder="e.g. 10">
          </div>
        </div>
        <div class="form-group mt-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="sendNow" name="send_now" value="1" checked>
            <label class="form-check-label" for="sendNow">Send now</label>
          </div>
        </div>
        <button type="submit" class="btn btn-success">Send / Save</button>
      </form>
    </div>

    <div class="card p-4 mt-4" style="border-radius:16px;">
      <h4 class="mb-3">Repeating Messages</h4>
      {% if scheduled %}
        {% for item in scheduled %}
          <div class="border rounded p-3 mb-2">
            <div><strong>{{ item.subject }}</strong></div>
            <div>Audience: {{ item.audience }} | Repeat: {{ item.repeat }}{% if item.interval_days %} ({{ item.interval_days }} days){% endif %}</div>
            <div>Next run: {% if item.next_run_at %}{{ item.next_run_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">No repeating messages.</p>
      {% endif %}
    </div>
  </div>
</section>

{% include 'freshbread/footer.html' %}
	<!-- ALL JS FILES -->
	<script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- ALL PLUGINS -->
	<script src="{% static 'js/jquery.superslides.min.js' %}"></script>
	<script src="{% static 'js/images-loded.min.js' %}"></script>
	<script src="{% static 'js/isotope.min.js' %}"></script>
	<script src="{% static 'js/baguetteBox.min.js' %}"></script>
	<script src="{% static 'js/form-validator.min.js' %}"></script>
    <script src="{% static 'js/contact-form-script.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
<script>
document.getElementById('insertPlaceholder').addEventListener('click', function(){
  const sel = document.getElementById('placeholders');
  const v = sel.value;
  if (!v) return;
  const ta = document.getElementById('body');
  const start = ta.selectionStart, end = ta.selectionEnd;
  const text = ta.value;
  ta.value = text.slice(0, start) + v + text.slice(end);
  ta.focus(); ta.selectionStart = ta.selectionEnd = start + v.length;
});
document.getElementById('repeat').addEventListener('change', function(){
  document.getElementById('customDaysBox').style.display = this.value === 'custom' ? 'block' : 'none';
});
</script>
</body>
</html>